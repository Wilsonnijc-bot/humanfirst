<ul class="thread-list" *ngIf="comments && comments.length > 0">
  <li class="thread-item" *ngFor="let comment of comments; trackBy: trackByComment">
    <article class="comment-card" [ngClass]="getStanceClass(comment.stance)">
      <header>
        <div class="comment-head-left">
          <span class="comment-user">{{comment.userName}}</span>
          <span class="comment-stance" [ngClass]="getStanceClass(comment.stance)">{{comment.stance}}</span>
        </div>
        <span class="comment-time">{{comment.duration}}</span>
      </header>

      <p class="comment-text">{{comment.text}}</p>

      <div class="comment-actions">
        <button
          type="button"
          class="comment-btn"
          [class.active]="comment.upVotedByCurrentUser"
          (click)="toggleCommentUpvote(comment)">
          Upvote ({{comment.upvoteCount}})
        </button>
        <button type="button" class="comment-btn" (click)="toggleReply(comment.id)">
          Reply
        </button>
        <button
          *ngIf="canDeleteComment(comment)"
          type="button"
          class="comment-btn danger"
          [disabled]="isDeletingComment(comment.id)"
          (click)="deleteComment(comment)">
          {{isDeletingComment(comment.id) ? 'Deleting...' : 'Delete'}}
        </button>
      </div>

      <div class="reply-editor" *ngIf="replyOpenMap[comment.id]">
        <div class="reply-stance-selector" role="radiogroup" aria-label="Select your reply stance">
          <button
            type="button"
            class="comment-btn stance pro"
            [class.active]="replyStanceMap[comment.id] === 'PRO'"
            [attr.aria-checked]="replyStanceMap[comment.id] === 'PRO'"
            role="radio"
            (click)="setReplyStance(comment.id, 'PRO')">
            Pro
          </button>
          <button
            type="button"
            class="comment-btn stance con"
            [class.active]="replyStanceMap[comment.id] === 'CON'"
            [attr.aria-checked]="replyStanceMap[comment.id] === 'CON'"
            role="radio"
            (click)="setReplyStance(comment.id, 'CON')">
            Con
          </button>
        </div>

        <textarea
          [value]="replyTextMap[comment.id] || ''"
          (input)="replyTextMap[comment.id] = $any($event.target).value"
          placeholder="Write a reply"></textarea>
        <button type="button" class="comment-btn primary" (click)="submitReply(comment)">
          Post Reply
        </button>
      </div>
    </article>

    <app-topic-comment-thread
      class="reply-thread"
      *ngIf="comment.replies && comment.replies.length > 0"
      [topicId]="topicId"
      [comments]="comment.replies"
      [isLoggedIn]="isLoggedIn"
      [currentUsername]="currentUsername"
      (threadUpdated)="onNestedThreadUpdated()">
    </app-topic-comment-thread>
  </li>
</ul>
